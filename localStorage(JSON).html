<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Web Storage JSON</title>
	<style>
		hr {
		  height: 2px;
		  color: black;
		  background-color: black;
		  width: 95%;
		}

		table {
		  border-collapse: collapse;
		  border-spacing: 0;
		  width: 100%;
		  border: 1px solid #ddd;
		}

		.contents {
		  margin-left: 5%;
		  margin-right: 5%;
		}

		.child-content {
		  border: 2px solid black;
		  padding-bottom: 2%;
		  margin-bottom: 1%;
		}

		.form-element {
		  margin: 2%;
		}

		#user-form {
		  width: 50%;
		  height: 40%;
		}

		#user-list {
		  margin-top: 1%;
		  width: 55%;
		}

		#instructions-list {
		  margin-left: 1%;
		  margin-right: 1%;
		}
		
	</style>
</head>
<body>
	<h1 align="center">Penambahan User Baru</h1>
	<div class="contents" align="center">
	  
	  <div class="child-content" id="user-form">
	    <h2>Form User Data</h2>
	    <hr>
	    <form id="form-data-user">
	      <div class="form-element">
	        <label for="nama">Nama user:</label><br>
	        <input id="nama" type="text" name="nama" placeholder="Nama user" value="" maxlength="10" required><br>
	      </div>
	      <div class="form-element">
	        <label for="umur">Umur user:</label><br>
	        <input id="umur" type="text" name="umur" placeholder="Umur user" value="" maxlength="2" required><br>
	      </div>
	      <div class="form-element">
	        <label for="domisili">Domisili user:</label><br>
	        <input id="domisili" type="text" name="domisili" placeholder="Domisili user" value="" maxlength="10"
	               required><br>
	      </div>
	      <div class="form-element">
	        <input id="submitButton" type="submit" value="Submit Data">
	      </div>
	    </form>
	  </div>
	  
	  <div class="child-content" id="user-list">
	    <h2>User List</h2>
	    <hr>
	    <table id=user-list-table>
	      <thead>
	        <tr>
	          <th>Nama</th>
	          <th>Umur</th>
	          <th>Domisili</th>
	        </tr>
	      </thead>
	      <tbody id="user-list-detail" align="center">
	      </tbody>
	    </table>
	  </div>
	</div>	

	<script type="text/javascript">
		// key storage
		const STORAGE_KEY = 'DATA';
		// menangkap form input
		const submitForm = document.getElementById('form-data-user');

		// fungsi cek local storage tersedia atau tidak
		function checkStorage() {
			return typeof(Storage) !== 'undefined';
		}

		function putUserList(data) {
			if (checkStorage()) {
				let dataUser = [];
				if (localStorage.getItem(STORAGE_KEY) !== null) {
					dataUser = JSON.parse(localStorage.getItem(STORAGE_KEY)); // merubah string menjadi objek json
				}

				dataUser.unshift(data);
				if (dataUser.length > 5) {
					dataUser.pop();
				}

				console.log(localStorage.setItem(STORAGE_KEY, JSON.stringify(dataUser))); // merubah objek menjadi string json
			}
		}

		function getUserList() {
			if (checkStorage()) {
				return JSON.parse(localStorage.getItem(STORAGE_KEY));
			} else {
				return [];
			}
		}

		// merender / menampilkan hasil
		function renderUserList() {
			const userData = getUserList();
			const userList = document.getElementById('user-list-detail');

			userList.innerHTML = '';
			for (let user of userData) {
				let row = document.createElement('tr');
				row.innerHTML = '<td>' + user.nama + '</td>';
				row.innerHTML += '<td>' + user.umur + '</td>';
				row.innerHTML += '<td>' + user.domisili + '</td>';

				userList.appendChild(row);
			}
		}

		// submit form
		submitForm.addEventListener('submit', function(event) {
			const nama = document.getElementById('nama').value;
			const umur = document.getElementById('umur').value;
			const domisili = document.getElementById('domisili').value;

			const newDataUser = {
				nama : nama,
				umur : umur,
				domisili : domisili,
			}

			putUserList(newDataUser);
			renderUserList();
			event.preventDefault();
		})

		// meng load halaman window browser
		window.addEventListener('load', function() {
			if (checkStorage()) {
				if (localStorage.getItem(STORAGE_KEY) !== null) {
					renderUserList();
				}
			}

			else {
				alert('Browser yang Anda gunakan tidak mendukung Web Storage');
			}
		})

	</script>
</body>
</html>